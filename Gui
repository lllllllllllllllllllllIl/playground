local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Check if Rayfield is loaded correctly
if not Rayfield then
    warn("Failed to load Rayfield library")
    return
end

local Window = Rayfield:CreateWindow({
    Name = "Vision Hub",
    LoadingTitle = "Vision Script",
    LoadingSubtitle = "by Vision",
    ConfigurationSaving = {
       Enabled = false,
       FileName = "Vision Script Hub"
    },
    Discord = {
       Enabled = true,
       Invite = "GYH92be25Z",
       RememberJoins = true
    },
    KeySystem = true,
    KeySettings = {
       Title = "Vision Script Hub| Key",
       Subtitle = "Link In Discord Server",
       Note = "Join Server From Misc Tab",
       FileName = "BladeBallKey",
       SaveKey = false,
       GrabKeyFromSite = true,
       Key = {"https://pastebin.com/raw/QZYyHa0H"}
    }
})

if not Window then
    warn("Failed to create window. Please check the Rayfield library or script parameters.")
    return
end

local MainTab = Window:CreateTab("Main", nil) -- Title, Image
local MainSection = MainTab:CreateSection("Useful") -- Changed 'Tab' to 'MainTab'

MainTab:CreateToggle({
    Name = "Auto Perfect Release",
    CurrentValue = false,
    Flag = "PerfectRelease_Toggle",
    Callback = function(Value)
        _G.PerfectRelease = Value

        -- Only hook once
        if not _G.PerfectReleaseHooked then
            _G.PerfectReleaseHooked = true

            -- Hook the action remote
            _G.bb = hookmetamethod(game, "__namecall", newcclosure(function(self, ...)
                local method = getnamecallmethod()
                local args = { ... }

                -- Only run auto-perfect if toggle is ON
                if _G.PerfectRelease 
                    and not checkcaller() 
                    and method == "FireServer" 
                    and tostring(self) == "Action" 
                    and typeof(args[1]) == "table"
                    and args[1].Type == "Shoot"
                    and args[1].Shoot == true then

                    -- Send original
                    _G.bb(self, unpack(args))

                    -- Auto-perfect end shot
                    task.delay(0.41, newcclosure(function()
                        self.FireServer(self, {
                            Shoot = false,
                            Type = "Shoot"
                        })
                    end))

                    return
                end

                return _G.bb(self, unpack(args))
            end))
        end

        print("Auto Perfect Release " .. (Value and "Enabled." or "Disabled."))
    end,
})
